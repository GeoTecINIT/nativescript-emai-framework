<Page
    navigatingTo="onNavigatingTo"
    xmlns="http://schemas.nativescript.org/tns.xsd">

    <ActionBar title="Tracked Events">
        <ActionBar.actionItems>
            <ActionItem tap="onExportTap" text="Export log"
                        ios.systemIcon="3" ios.position="left"
                        android.systemIcon="ic_menu_save" android.position="actionBar"/>
            <ActionItem tap="onClearEvents" text="Clear events"
                        ios.systemIcon="16" ios.position="right"
                        android.position="popup"/>
        </ActionBar.actionItems>
    </ActionBar>

    <GridLayout rows="*" columns="*">
        <ListView row="0" col="0" visibility="{{ exportingRecords ? 'collapsed' : 'visible' }}"
                  items="{{ records }}"
                  loadMoreItems="onLoadMoreItems"
                  separatorColor="orangered" rowHeight="140"
                  class="list-group" itemTemplateSelector="type"
                  id="listView">
            <ListView.itemTemplates>
                <!-- The item template can only have a single root view container (e.g. GriLayout, StackLayout, etc.) -->
                <template key="geolocation">
                    <GridLayout columns="auto, *" rows="auto, auto, auto, auto" class="list-group-item">
                        <Label text="Geolocation" row="0" col="0" textWrap="true" class="h3" />
                        <Label text="{{ timestamp }}" row="0" col="1" textWrap="true" class="h4 text-right" />
                        <Label text="{{ latitude, 'Latitude: ' + latitude }}" row="1" col="0" colSpan="2" textWrap="true" class="title" />
                        <Label text="{{ longitude, 'Longitude: ' + longitude }}" row="2" col="0" colSpan="2" textWrap="true" class="title" />
                        <Label text="{{ horizontalAccuracy, 'Accuracy: ' + horizontalAccuracy + 'm' }}" row="3" col="0" colSpan="2" textWrap="true" class="title" />
                    </GridLayout>
                </template>
                <template key="human-activity">
                    <GridLayout columns="auto, *" rows="auto, auto, auto, auto" class="list-group-item">
                        <Label text="Human Activity" row="0" col="0" textWrap="true" class="h3" />
                        <Label text="{{ timestamp }}" row="0" col="1" textWrap="true" class="h4 text-right" />
                        <Label text="{{ change, 'Change: ' + change }}" row="1" col="0" colSpan="2" textWrap="true" class="title" />
                        <Label text="{{ activity, 'Type: ' + activity }}" row="2" col="0" colSpan="2" textWrap="true" class="title" />
                        <Label text="{{ confidence, 'Confidence: ' + (!!confidence ? (confidence + '%') : '--') }}" row="3" col="0" colSpan="2" textWrap="true" class="title" />
                    </GridLayout>
                </template>
            </ListView.itemTemplates>
        </ListView>

        <GridLayout rows="*, *" columns="*" visibility="{{ exportingRecords ? 'visible' : 'collapsed' }}">
            <StackLayout row="0" col="0" verticalAlignment="bottom">
                <Label text="Exporting records." class="h2" horizontalAlignment="center"/>
                <Label text="Please wait..." class="h3" horizontalAlignment="center"/>
            </StackLayout>
            <ActivityIndicator row="1" col="0" busy="{{ exportingRecords }}"
                               verticalAlignment="center" horizontalAlignment="center"/>
        </GridLayout>
    </GridLayout>

</Page>
